# Trading Service

The Trading Service is a Go-based application that aggregates real-time trade data from the Binance WebSocket API into 1-minute OHLC (Open, High, Low, Close) candlesticks. It persists the candlesticks in a PostgreSQL database and exposes them via a REST API. The service is designed with an open architecture, making it modular, testable, and extensible.

## Architecture 

Trading Service works on port 8080.
Grpc Service for broadcast work on 50051.
In folder docs is project_structure like image and how projects works in video folder

The project follows an **open architecture** (clean architecture) with the following layers:

- **Domain Layer (`internal/domain`)**:
    - Contains core business logic and entities (`Trade`, `OHLC`).
    - `CandlestickAggregator`: Aggregates trades into 1-minute OHLC candlesticks.
- **Application Layer (`internal/application`)**:
    - Orchestrates business logic and use cases.
    - `CandlestickService`: Manages trade aggregation, storage, and broadcasting.
    - `APIHandler`: Exposes candlesticks via a REST API using Fiber.
- **Infrastructure Layer (`internal/infrastructure`)**:
    - Handles external services and implementations.
    - `BinanceClient`: Connects to Binance WebSocket streams and sends trades.
    - `GORMStorage`: Persists candlesticks in PostgreSQL using GORM.
- **Interfaces Layer (`internal/interfaces`)**:
    - Defines contracts (`Exchange`, `Storage`) for dependency injection, enabling loose coupling.
- **Configuration (`config`)**:
    - Loads settings from `config.yaml` and `.env` using `godotenv`.
- **gRPC Server (`internal/server`)**:
    - Implements a gRPC server for streaming candlesticks in real-time.
    - `candlestickServer`: Streams candlesticks for a specified symbol using the `StreamCandlesticks` method.

The application uses **Docker** and **Docker Compose** for containerization and PostgreSQL as the database. It can be deployed locally or in a Kubernetes cluster. TLS certificates are generated for secure gRPC communication using self-signed certificates.

## New Features

- **gRPC Streaming API**: Added a gRPC server that streams candlesticks in real-time for a specified symbol. The server runs on port `50051` and supports TLS for secure communication. The `StreamCandlesticks` method allows clients to receive a continuous stream of candlesticks as they are generated.
- **TLS Support**: The gRPC server uses TLS credentials generated by the `make certs` target. If TLS fails to load, the server falls back to plaintext for debugging purposes.

The application uses **Docker** and **Docker Compose** for containerization and PostgreSQL as the database. It can be deployed locally or in a Kubernetes cluster. TLS certificates are generated for secure communication using self-signed certificates.

## Prerequisites

- **Go**: Version 1.23 or later.
- **Docker**: For containerized deployment.
- **Docker Compose**: For local multi-container setup.
- **Kubernetes**: For K8s deployment (e.g., `minikube` or a cloud provider).
- **kubectl**: For interacting with Kubernetes.
- **OpenSSL**: For generating self-signed TLS certificates.
- **Make**: To use the provided `Makefile`.
- **gRPCurl**: For testing gRPC endpoints (if extended to use gRPC).

## Setup and Configuration

1. **Clone the Repository**:
   ```bash
   git clone github.com/aleksbgs/binancetrading
   cd binancetrading
   make docker-up
   make test

2. **API Access Examples**:
   ```bash
    grpcurl -cacert cert/server.crt -d '{"symbol":"BTCUSDT"}' localhost:50051 candlestick.CandlestickService/StreamCandlesticks
    curl http://localhost:8080/candlesticks/BTCUSDT
   
 



